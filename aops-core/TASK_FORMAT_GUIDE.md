# Task File Format in the academicOps PKB

## Overview

The academicOps framework manages tasks as flat markdown files with YAML frontmatter. Task files are organized hierarchically in the filesystem and connected via graph relationships (dependencies, hierarchy) expressed in the frontmatter itself, not folder structure.

## Directory Structure

```
$ACA_DATA/
├── {project}/
│   └── tasks/
│       ├── 20260112-write-book.md
│       ├── 20260113-chapter-outline.md
│       └── ...
├── tasks/
│   ├── index.json (generated by fast-indexer)
│   └── inbox/
│       └── 20260112-random-idea.md
└── {other-project}/
    └── tasks/
        └── ...
```

**Key Points:**
- Tasks are flat within project directories (not hierarchical folders)
- Each project has its own `tasks/` subdirectory
- Tasks without a project go to `tasks/inbox/`
- There's a generated `tasks/index.json` for fast indexing
- Global inbox at `tasks/inbox/` for unassigned tasks

## Task File Format

### File Naming Convention

```
{task-id}-{slug}.md
```

**Example:** `20260121-task-slug.md`

Where:
- `task-id`: Timestamp-based ID (e.g., `20260121-aops-f67d`)
- `slug`: URL-friendly version of the title (lowercase, hyphens)

### Frontmatter (YAML)

#### Minimal Example

```yaml
---
id: 20260121-task-slug
title: Task title here
type: task
status: active
project: project-slug
---
```

#### Complete Example with All Fields

```yaml
---
id: 20260121-implement-dashboard
title: Implement Overwhelm Dashboard
type: epic
status: in_progress
project: aops
priority: 0
due: 2026-02-15
parent: 20260115-cognitive-load
depends_on:
  - 20260110-fast-indexer-stable
  - 20260114-session-indexing
soft_depends_on:
  - 20260112-ux-research
assignee: polecat
complexity: multi-step
tags:
  - dashboard
  - priority
  - visibility
worker_id: polecat-claude-1
pr_url: https://github.com/...
unblock_condition: null
diagnostic: null
---
```

### Required Fields

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `id` | string | Unique identifier (timestamp + slug) | `20260121-implement-dashboard` |
| `title` | string | Human-readable task title | `Implement Overwhelm Dashboard` |
| `type` | enum | Task semantic level | `task`, `goal`, `project`, `epic`, `action`, `bug`, `feature`, `learn` |
| `status` | enum | Current state | `inbox`, `active`, `in_progress`, `done`, `blocked`, `waiting`, `cancelled` |
| `project` | string | Project slug or `uncategorized` | `aops`, `book`, `dissertation` |

### Optional Fields

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `priority` | int | 0=critical, 1=high, 2=medium, 3=low, 4=someday | `0` |
| `due` | date | Due date in YYYY-MM-DD format | `2026-02-15` |
| `parent` | string | Parent task ID for hierarchy | `20260115-cognitive-load` |
| `depends_on` | list[string] | Hard blocking dependencies | `[20260110-fast-indexer, 20260114-indexing]` |
| `soft_depends_on` | list[string] | Non-blocking context dependencies | `[20260112-ux-research]` |
| `tags` | list[string] | Topic tags for categorization | `[dashboard, priority, visibility]` |
| `assignee` | string | Task owner: `nic` (human), `polecat` (agent), or null | `polecat` |
| `complexity` | enum | Routing classification | `mechanical`, `requires-judgment`, `multi-step`, `needs-decomposition`, `blocked-human` |
| `worker_id` | string | Active worker agent ID (set when claimed) | `polecat-claude-1` |
| `pr_url` | string | Pull request URL (for REVIEW/MERGE_READY status) | `https://github.com/...` |
| `unblock_condition` | string | What must happen to unblock (BLOCKED status) | `"Email feedback from reviewer"` |
| `diagnostic` | string | Error reason (FAILED status) | `"Timeout after 30 minutes"` |

## Task Type Hierarchy

Semantic levels for decomposition:

```
GOAL (multi-month/year outcome)
  ├─ PROJECT (coherent body of work)
  │   └─ EPIC (group of tasks toward milestone)
  │       ├─ TASK (discrete deliverable)
  │       ├─ ACTION (single work session)
  │       ├─ BUG (defect to fix)
  │       └─ FEATURE (new functionality)
  └─ LEARN (observational tracking, not actionable)
```

## Task Status Lifecycle

```
INBOX (new task, not yet triaged)
  ↓
ACTIVE (ready to be claimed, no blockers)
  ├─ → IN_PROGRESS (worker claims & starts work)
  │     ├─ → REVIEW (PR filed, awaiting review)
  │     │     ├─ → MERGE_READY (reviews done, awaiting merge)
  │     │     │     └─ → MERGING (currently being merged)
  │     │     │           └─ → DONE (completed)
  │     │     └─ → IN_PROGRESS (changes requested)
  │     └─ → BLOCKED (dependency discovered)
  │
  ├─ → DECOMPOSING (breaking down into subtasks)
  │     ├─ → CONSENSUS (multi-agent review in progress)
  │     │     └─ → WAITING (awaiting user decision)
  │     │           ├─ → IN_PROGRESS (user approves)
  │     │           ├─ → DECOMPOSING (user requests changes)
  │     │           └─ → ACTIVE (user sends back)
  │     └─ → BLOCKED (external dependency found)
  │
  ├─ → BLOCKED (unblock_condition required)
  ├─ → FAILED (diagnostic required, unrecoverable)
  ├─ → CANCELLED (reason required)
  └─ → DORMANT (user-initiated backburner)
```

## Task Body (Markdown Content)

The file body contains task details in markdown format:

```markdown
# Context

Description of what the task is about, why it matters, and any relevant background.

## Requirements

- [ ] Requirement 1
- [ ] Requirement 2
- [ ] Requirement 3

## Subtasks

- [ ] Subtask 1: Detailed action item
- [ ] Subtask 2: Another action item

## Findings (if applicable)

Summary of spike findings or research results.

## Blockers

- Dependency: [[20260110-fast-indexer]]
- External: Waiting for code review feedback
```

## Hierarchical Relationships

### Hard Dependencies (Blocking)

```yaml
depends_on:
  - 20260110-fast-indexer-stable
  - 20260114-session-indexing
```

**Meaning:** Task CANNOT proceed until dependencies are complete.

**Use when:** Dependency produces required input or output that the task needs.

### Soft Dependencies (Context)

```yaml
soft_depends_on:
  - 20260112-ux-research
  - 20260108-requirements
```

**Meaning:** Task BENEFITS from context but can proceed regardless.

**Use when:** Dependency provides optional context or patterns, but not strictly required.

### Parent-Child Hierarchy

```yaml
parent: 20260115-cognitive-load-epic
```

**Meaning:** Task is a child of an epic/goal. Used for decomposition.

**Structure:**
- Goals contain Projects
- Projects contain Epics
- Epics contain Tasks/Actions/Features
- Tasks can contain Actions

## Overwhelm Dashboard Fields (from index.json)

The fast-indexer generates `$ACA_DATA/tasks/index.json` with this schema:

```json
{
  "generated": "2026-01-21T10:00:00Z",
  "total_tasks": 42,
  "tasks": [
    {
      "id": "20260121-task-slug",
      "title": "Task title",
      "status": "active",
      "priority": 0,
      "project": "project-slug",
      "due": "2026-01-25",
      "parent": "20260120-parent-task",
      "depends_on": ["20260119-dependency"],
      "tags": ["tag1", "tag2"],
      "file": "data/aops/tasks/20260121-task-slug.md"
    }
  ],
  "priority_by_project": {
    "aops": ["task-1", "task-2"],
    "uncategorized": ["misc-task"]
  },
  "priority_by_due": {
    "overdue": [],
    "this_week": ["task-1"],
    "next_week": [],
    "later": ["task-2"],
    "no_date": ["misc-task"]
  }
}
```

## Hierarchy Quality Rules

These rules prevent the structural problems that make task maps unreadable and projects unnavigable.

### The WHY Test

Every task MUST answer: **"Why does this exist in the context of its parent?"**

If you can't articulate the purpose in terms of the parent's goals, the task is either:
- Misplaced (wrong parent)
- Missing an intermediate epic that provides context
- An orphan that needs to be connected or questioned

**Bad**: `TJA → GCS → DuckDB dbt pipeline refactor`
- WHY? No idea. Infrastructure task with no stated purpose under a research project.

**Good**: `TJA → Epic: Move results to local cache for reproducible analysis → Task: Refactor GCS pipeline to DuckDB`
- WHY the epic? Because TJA needs reproducible local analysis without cloud dependencies.
- WHY the task? Because the epic requires migrating from GCS to a local store.

### The Abstraction Level Test

Children MUST be exactly one semantic level below their parent:

```
PROJECT children should be: EPIC (or GOAL, rarely)
EPIC children should be:    TASK, BUG, FEATURE, LEARN
TASK children should be:    ACTION
```

**Violations to watch for:**
- A PROJECT with TASK children → missing EPIC layer
- An EPIC with ACTION children → missing TASK layer
- A GOAL containing TASKs directly → missing PROJECT and EPIC layers

### The Star Pattern Anti-Pattern

**If a node has more than 5 direct children, it almost certainly needs intermediate grouping.**

A project with 10 direct children is a flat list, not a hierarchy. This happens when:
- Tasks are created ad-hoc without thinking about where they fit
- Implementation steps are parented directly to the project
- Epics are missing

**Fix:** Group related children under epics that explain a coherent milestone or workstream.

### The "Is This Really a Task?" Test

Before creating a task, ask:

| Question | If YES → |
|----------|----------|
| Will this take multiple sessions? | It's probably an **epic**, not a task |
| Does this have multiple distinct deliverables? | It's probably an **epic** |
| Is this a single step in a larger process? | Find or create the parent epic first |
| Is this infrastructure that serves a research goal? | Create the research epic first, then the infra task under it |
| Can I finish this in one focused session (1-4h)? | It's a **task** |
| Can I finish this in under 30 minutes? | It's an **action** |

### Anti-Patterns with Examples

**Anti-pattern 1: Implementation details at project level**
```
BAD:  Project: TJA
        ├── Fetch batch results for Sonnet     ← leaf task directly under project
        ├── Fetch batch results for 4-model    ← another leaf task
        └── Submit Gemini batch runs           ← another leaf task

GOOD: Project: TJA
        └── Epic: Validate multi-model batch predictions
              ├── Task: Fetch and verify Sonnet batch results
              ├── Task: Fetch and verify 4-model batch results
              └── Task: Submit Gemini Pro + Opus judge-only runs
```

**Anti-pattern 2: Infrastructure without strategic justification**
```
BAD:  Project: TJA
        └── GCS → DuckDB pipeline refactor     ← WHY? No context.

GOOD: Project: TJA
        └── Epic: Local reproducible analysis pipeline
              ├── Task: Refactor GCS → DuckDB pipeline
              └── Task: Validate local results match cloud
```

**Anti-pattern 3: Mixed abstraction levels**
```
BAD:  Project: TJA
        ├── Draft methodology section          ← 2-hour writing task
        ├── Incorporate longitudinal findings   ← multi-week epic
        └── problems with golden answers        ← investigation/bug

GOOD: Project: TJA
        ├── Epic: Complete paper draft
        │     ├── Task: Draft methodology section
        │     ├── Task: Write up accuracy validation results
        │     └── Task: Draft methodology section
        ├── Epic: Incorporate longitudinal findings
        │     ├── Learn: Analyze longitudinal data patterns
        │     └── Task: Write longitudinal findings section
        └── Epic: Resolve data quality issues
              ├── Bug: Problems with golden answers
              └── Task: Fix golden answer validation pipeline
```

**Anti-pattern 4: Orphaned features**
```
BAD:  Feature: Add structured output support to buttermilk
        (no parent, floating in space)

GOOD: Project: TJA
        └── Epic: Structured output validation
              └── Feature: Add structured output support to buttermilk
      (or if it's truly a buttermilk feature, parent it there with
       a soft_depends_on from the TJA task that needs it)
```

## Common Patterns

### Decomposition with Spikes

For uncertain work, investigate first before implementing:

```yaml
# Parent epic
---
id: 20260120-feature-design
title: Design feature X
type: epic
---

# Child spike (learn task)
---
id: 20260121-spike-investigate
title: Investigate framework options
type: learn
parent: 20260120-feature-design
depends_on: []
---

# Implementation (depends on spike findings)
---
id: 20260122-implement-feature
title: Implement feature X
type: task
parent: 20260120-feature-design
depends_on: [20260121-spike-investigate]
---
```

### Task with Assigned Worker

```yaml
---
id: 20260121-bug-fix
title: Fix slow query in dashboard
type: bug
status: in_progress
assignee: polecat
worker_id: polecat-claude-1
---
```

### Waiting on External Input

```yaml
---
id: 20260121-get-feedback
title: Receive design feedback from team
type: task
status: blocked
complexity: blocked-human
unblock_condition: "Email received from design team with feedback"
---

# Blocks this:
---
id: 20260122-implement-feedback
title: Implement design feedback
type: task
depends_on: [20260121-get-feedback]
---
```

### Multi-level Hierarchy

```yaml
# Project
---
id: 20260101-aops-project
title: academicOps Framework
type: project
project: aops
---

# Goal under project
---
id: 20260102-visibility-goal
title: Improve task visibility
type: goal
project: aops
parent: 20260101-aops-project
---

# Epic under goal
---
id: 20260103-dashboard-epic
title: Build overwhelm dashboard
type: epic
project: aops
parent: 20260102-visibility-goal
---

# Task under epic
---
id: 20260104-implement-task
title: Implement dashboard UI
type: task
project: aops
parent: 20260103-dashboard-epic
---

# Action under task
---
id: 20260105-ui-action
title: Create main layout component
type: action
project: aops
parent: 20260104-implement-task
---
```

## Implementation Details

### Task ID Generation

IDs are generated from timestamp + slug:
```
{timestamp}-{project-slug} or {timestamp}-{slug}
```

Example: `20260121-aops-f67d` or `20260121-overwhelm-dashboard`

The timestamp ensures uniqueness and provides sortability.

### Validation Rules

1. **Required frontmatter:** All required fields must be present
2. **Valid enum values:** Status, type, complexity must match defined enums
3. **Connected hierarchy:** Tasks with `parent` must reference existing parent
4. **Dependency validation:** Tasks in `depends_on` must exist
5. **Project matching:** `project` field should match a project file

### File Path Matching

File path should follow: `{project}/tasks/{id}-{slug}.md`

Examples:
- `/aops/tasks/20260121-overwhelm-dashboard.md`
- `/book/tasks/20260115-chapter-outline.md`
- `/tasks/inbox/20260120-random-idea.md`

## Related Specs

- `specs/overwhelm-dashboard.md` - Dashboard implementation
- `archived/specs/task-list-overwhelm.md` - Task state index design
- `aops-core/lib/task_model.py` - Task Python model
- `aops-core/lib/task_storage.py` - Task storage layer

## Tools for Task Management

- **fast-indexer** (Rust binary) - Generates `index.json` from task files
- **Task MCP Server** - CRUD operations on tasks
- **task-viz** - Network visualization of task graph
- **Dashboard** - Streamlit app for viewing overwhelm state
