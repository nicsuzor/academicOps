# Issue review pipeline: custodiet and hydrator review new proposals.
# Both agents run in parallel on newly opened issues.
#
# PR reviews are handled by pr-review-pipeline.yml — this workflow is issues only.
#
# Skips: bot-created issues, issues labeled 'epic' (tracking issues, not proposals)

name: Issue Review

on:
  issues:
    types: [opened]

jobs:
  # ──────────────────────────────────────────────
  # Custodiet: proposal quality (user story, AC, scope)
  # ──────────────────────────────────────────────
  custodiet:
    name: Custodiet
    # Skip bot-created issues and epics
    if: >-
      !github.event.issue.pull_request &&
      github.actor != 'dependabot[bot]' &&
      github.actor != 'claude[bot]' &&
      github.actor != 'github-actions[bot]' &&
      !contains(github.event.issue.labels.*.name, 'epic')
    uses: ./.github/workflows/agent-custodiet.yml
    with:
      target_type: issue
      target_number: ${{ github.event.issue.number }}
    secrets: inherit

  # ──────────────────────────────────────────────
  # Hydrator: infrastructure context and workflow guidance
  # ──────────────────────────────────────────────
  hydrator:
    name: Hydrator
    # Skip bot-created issues and epics
    if: >-
      !github.event.issue.pull_request &&
      github.actor != 'dependabot[bot]' &&
      github.actor != 'claude[bot]' &&
      github.actor != 'github-actions[bot]' &&
      !contains(github.event.issue.labels.*.name, 'epic')
    uses: ./.github/workflows/agent-hydrator.yml
    with:
      target_type: issue
      target_number: ${{ github.event.issue.number }}
    secrets: inherit
