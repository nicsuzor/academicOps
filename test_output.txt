============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0
rootdir: /app
configfile: pyproject.toml
plugins: cov-7.0.0, timeout-2.4.0, xdist-3.8.0, anyio-4.12.1
created: 16/16 workers
16 workers [3 items]

..F
=================================== FAILURES ===================================
_______________________ test_gate_open_close_unification _______________________
[gw2] linux -- Python 3.12.12 /app/.venv/bin/python

mock_session = 'test_session_unification'

    def test_gate_open_close_unification(mock_session):
        """Test that open_gate and close_gate update unified state and helpers work."""
        session_id = mock_session

        # Open critic gate
        open_gate(session_id, "critic")
        state = session_state.SessionState.load(session_id)
        print(f"DEBUG TEST: After Open - Date: {state.date}, Status: {state.gates['critic'].status}")
        assert state.gates["critic"].status == "open"

        # Close critic gate
        close_gate(session_id, "critic")
        state = session_state.SessionState.load(session_id)
        print(f"DEBUG TEST: After Close - Date: {state.date}, Status: {state.gates['critic'].status}")
>       assert state.gates["critic"].status == "closed"
E       AssertionError: assert 'open' == 'closed'
E
E         - closed
E         + open

aops-core/tests/hooks/test_gates_unification.py:34: AssertionError
=========================== short test summary info ============================
FAILED aops-core/tests/hooks/test_gates_unification.py::test_gate_open_close_unification
========================= 1 failed, 2 passed in 4.43s ==========================
