{
  "_comment": "Gate verdict scenarios for regression testing. Each entry represents a realistic hook call and its expected gate verdict. Grouped by category. 'gate_overrides' sets initial gate state before dispatch. 'expected' defines the verdict the router should produce. Gate modes are forced to defaults by the test fixture: hydration=warn, custodiet=block, qa=block, handover=warn.",

  "hydration_gate_blocks_write_tools": [
    {
      "id": "edit_warned_when_hydration_closed",
      "description": "Edit tool should be warned when hydration gate is closed (mode=warn)",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/some/file.py", "old_string": "foo", "new_string": "bar"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "write_warned_when_hydration_closed",
      "description": "Write tool should be warned when hydration gate is closed",
      "hook_event": "PreToolUse",
      "tool_name": "Write",
      "tool_input": {"file_path": "/some/file.py", "content": "hello"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "bash_warned_when_hydration_closed",
      "description": "Bash tool should be warned when hydration gate is closed",
      "hook_event": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {"command": "echo hello"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "notebook_edit_warned_when_hydration_closed",
      "description": "NotebookEdit tool should be warned when hydration gate is closed",
      "hook_event": "PreToolUse",
      "tool_name": "NotebookEdit",
      "tool_input": {"notebook_path": "/some/notebook.ipynb", "new_source": "x = 1"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "gemini_write_file_warned_when_hydration_closed",
      "description": "Gemini write_file should be warned when hydration gate is closed",
      "hook_event": "PreToolUse",
      "tool_name": "write_file",
      "tool_input": {"path": "/some/file.py", "content": "hello"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "gemini_run_shell_warned_when_hydration_closed",
      "description": "Gemini run_shell_command should be warned when hydration gate is closed",
      "hook_event": "PreToolUse",
      "tool_name": "run_shell_command",
      "tool_input": {"command": "ls -la"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "unknown_tool_warned_when_hydration_closed",
      "description": "Unknown tools default to write category and should be warned",
      "hook_event": "PreToolUse",
      "tool_name": "SomeNewTool",
      "tool_input": {"data": "whatever"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    }
  ],

  "hydration_gate_warns_read_only": [
    {
      "id": "read_warned_when_hydration_closed",
      "description": "Read is read_only but NOT exempt from hydration gate (only always_available is exempt)",
      "hook_event": "PreToolUse",
      "tool_name": "Read",
      "tool_input": {"file_path": "/some/file.py"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "glob_warned_when_hydration_closed",
      "description": "Glob is read_only but NOT exempt from hydration gate",
      "hook_event": "PreToolUse",
      "tool_name": "Glob",
      "tool_input": {"pattern": "**/*.py"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "grep_warned_when_hydration_closed",
      "description": "Grep is read_only but NOT exempt from hydration gate",
      "hook_event": "PreToolUse",
      "tool_name": "Grep",
      "tool_input": {"pattern": "def test_"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "web_search_warned_when_hydration_closed",
      "description": "WebSearch is read_only but NOT exempt from hydration gate",
      "hook_event": "PreToolUse",
      "tool_name": "WebSearch",
      "tool_input": {"query": "python testing"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "gemini_read_file_warned_when_hydration_closed",
      "description": "Gemini read_file is read_only but NOT exempt from hydration gate",
      "hook_event": "PreToolUse",
      "tool_name": "read_file",
      "tool_input": {"path": "/some/file.py"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "gemini_grep_search_warned_when_hydration_closed",
      "description": "Gemini grep_search is read_only but NOT exempt from hydration gate",
      "hook_event": "PreToolUse",
      "tool_name": "grep_search",
      "tool_input": {"pattern": "class Foo"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "pkb_search_warned_when_hydration_closed",
      "description": "PKB read-only tools NOT exempt from hydration gate",
      "hook_event": "PreToolUse",
      "tool_name": "mcp__pkb__task_search",
      "tool_input": {"query": "test"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    }
  ],

  "read_only_bypasses_custodiet": [
    {
      "id": "read_bypasses_custodiet_at_threshold",
      "description": "Read is read_only and bypasses custodiet gate even at threshold",
      "hook_event": "PreToolUse",
      "tool_name": "Read",
      "tool_input": {"file_path": "/some/file.py"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 60}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "glob_bypasses_custodiet_at_threshold",
      "description": "Glob is read_only and bypasses custodiet gate even at threshold",
      "hook_event": "PreToolUse",
      "tool_name": "Glob",
      "tool_input": {"pattern": "**/*.py"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 60}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "grep_bypasses_custodiet_at_threshold",
      "description": "Grep is read_only and bypasses custodiet gate even at threshold",
      "hook_event": "PreToolUse",
      "tool_name": "Grep",
      "tool_input": {"pattern": "def foo"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 60}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "gemini_read_file_bypasses_custodiet_at_threshold",
      "description": "Gemini read_file is read_only and bypasses custodiet gate",
      "hook_event": "PreToolUse",
      "tool_name": "read_file",
      "tool_input": {"path": "/some/file.py"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 60}
      },
      "expected": {"verdict": "allow"}
    }
  ],

  "hydration_gate_allows_always_available": [
    {
      "id": "task_tool_allowed_when_hydration_closed",
      "description": "Task (spawn subagent) is always_available, bypasses all gates",
      "hook_event": "PreToolUse",
      "tool_name": "Task",
      "tool_input": {"subagent_type": "aops-core:prompt-hydrator", "prompt": "hydrate"},
      "is_subagent": false,
      "subagent_type": "aops-core:prompt-hydrator",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "skill_tool_allowed_when_hydration_closed",
      "description": "Skill (invoke skill) is always_available, bypasses all gates",
      "hook_event": "PreToolUse",
      "tool_name": "Skill",
      "tool_input": {"skill": "commit"},
      "is_subagent": false,
      "subagent_type": "commit",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "delegate_to_agent_allowed_when_hydration_closed",
      "description": "Gemini delegate_to_agent is always_available",
      "hook_event": "PreToolUse",
      "tool_name": "delegate_to_agent",
      "tool_input": {"name": "prompt-hydrator", "query": "hydrate"},
      "is_subagent": false,
      "subagent_type": "prompt-hydrator",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "ask_user_question_allowed_when_hydration_closed",
      "description": "AskUserQuestion is always_available",
      "hook_event": "PreToolUse",
      "tool_name": "AskUserQuestion",
      "tool_input": {"questions": [{"question": "Ready?", "header": "Confirm", "options": [], "multiSelect": false}]},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "pkb_create_task_allowed_when_hydration_closed",
      "description": "PKB task management is always_available",
      "hook_event": "PreToolUse",
      "tool_name": "mcp__pkb__create_task",
      "tool_input": {"task_title": "test task"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "gemini_activate_skill_allowed_when_hydration_closed",
      "description": "Gemini activate_skill is always_available",
      "hook_event": "PreToolUse",
      "tool_name": "activate_skill",
      "tool_input": {"skill": "dump"},
      "is_subagent": false,
      "subagent_type": "dump",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow"}
    }
  ],

  "hydration_gate_allows_when_open": [
    {
      "id": "edit_allowed_when_hydration_open",
      "description": "Edit is allowed when hydration gate is open (hydrated)",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/some/file.py", "old_string": "a", "new_string": "b"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "bash_allowed_when_hydration_open",
      "description": "Bash is allowed when hydration gate is open",
      "hook_event": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {"command": "echo hello"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"}
      },
      "expected": {"verdict": "allow"}
    }
  ],

  "compliance_agent_bypass": [
    {
      "id": "hydrator_subagent_edit_allowed_when_hydration_closed",
      "description": "Hydrator subagent calling Edit bypasses gate policies (compliance bypass)",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/tmp/hydration.md", "old_string": "x", "new_string": "y"},
      "is_subagent": true,
      "subagent_type": "aops-core:prompt-hydrator",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "never_deny": true}
    },
    {
      "id": "hydrator_subagent_write_allowed_when_hydration_closed",
      "description": "Hydrator subagent calling Write bypasses gate policies",
      "hook_event": "PreToolUse",
      "tool_name": "Write",
      "tool_input": {"file_path": "/tmp/output.md", "content": "hydrated"},
      "is_subagent": true,
      "subagent_type": "prompt-hydrator",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "never_deny": true}
    },
    {
      "id": "hydrator_subagent_bash_allowed_when_hydration_closed",
      "description": "Hydrator subagent calling Bash bypasses gate policies",
      "hook_event": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {"command": "cat /tmp/context.md"},
      "is_subagent": true,
      "subagent_type": "hydrator",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "never_deny": true}
    },
    {
      "id": "custodiet_subagent_edit_allowed_always",
      "description": "Custodiet subagent calling Edit bypasses gate policies",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/tmp/report.md", "old_string": "a", "new_string": "b"},
      "is_subagent": true,
      "subagent_type": "aops-core:custodiet",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}},
        "custodiet": {"status": "open", "ops_since_open": 60}
      },
      "expected": {"verdict": "allow", "never_deny": true}
    },
    {
      "id": "custodiet_subagent_bash_allowed_always",
      "description": "Custodiet subagent calling Bash bypasses gate policies",
      "hook_event": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {"command": "git status"},
      "is_subagent": true,
      "subagent_type": "custodiet",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}},
        "custodiet": {"status": "open", "ops_since_open": 60}
      },
      "expected": {"verdict": "allow", "never_deny": true}
    },
    {
      "id": "audit_subagent_write_allowed_always",
      "description": "Audit subagent calling Write bypasses gate policies",
      "hook_event": "PreToolUse",
      "tool_name": "Write",
      "tool_input": {"file_path": "/tmp/audit.md", "content": "audit report"},
      "is_subagent": true,
      "subagent_type": "aops-core:audit",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "never_deny": true}
    },
    {
      "id": "butler_subagent_edit_allowed_always",
      "description": "Butler subagent calling Edit bypasses gate policies",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/tmp/status.md", "old_string": "x", "new_string": "y"},
      "is_subagent": true,
      "subagent_type": "aops-core:butler",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "never_deny": true}
    },
    {
      "id": "hydrator_active_flag_bypasses_all",
      "description": "Legacy hydrator_active flag in state dict bypasses all gates",
      "hook_event": "PreToolUse",
      "tool_name": "Write",
      "tool_input": {"file_path": "/tmp/out.md", "content": "hello"},
      "is_subagent": true,
      "subagent_type": null,
      "state_overrides": {"hydrator_active": true},
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "never_deny": true}
    }
  ],

  "non_compliance_subagent_blocked": [
    {
      "id": "explore_subagent_write_warned_when_hydration_closed",
      "description": "Non-compliance subagent (Explore) is NOT exempt from gates",
      "hook_event": "PreToolUse",
      "tool_name": "Write",
      "tool_input": {"file_path": "/tmp/out.py", "content": "x"},
      "is_subagent": true,
      "subagent_type": "Explore",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "qa_subagent_edit_warned_when_hydration_closed",
      "description": "QA subagent is NOT in compliance types, subject to gates",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/tmp/out.py", "old_string": "a", "new_string": "b"},
      "is_subagent": true,
      "subagent_type": "aops-core:qa",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "general_purpose_subagent_bash_warned_when_hydration_closed",
      "description": "General purpose subagent is NOT exempt from gates",
      "hook_event": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {"command": "make test"},
      "is_subagent": true,
      "subagent_type": "general-purpose",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "warn"}
    }
  ],

  "custodiet_gate_blocks_at_threshold": [
    {
      "id": "edit_denied_when_custodiet_threshold_exceeded",
      "description": "Edit denied when ops_since_open >= threshold (mode=block)",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/some/file.py", "old_string": "a", "new_string": "b"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 55}
      },
      "expected": {"verdict": "deny"}
    },
    {
      "id": "bash_denied_when_custodiet_threshold_exceeded",
      "description": "Bash denied when custodiet threshold exceeded",
      "hook_event": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {"command": "npm test"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 50}
      },
      "expected": {"verdict": "deny"}
    },
    {
      "id": "read_allowed_when_custodiet_threshold_exceeded",
      "description": "Read is read_only and bypasses custodiet gate",
      "hook_event": "PreToolUse",
      "tool_name": "Read",
      "tool_input": {"file_path": "/some/file.py"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 55}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "task_allowed_when_custodiet_threshold_exceeded",
      "description": "Task is always_available and bypasses custodiet gate",
      "hook_event": "PreToolUse",
      "tool_name": "Task",
      "tool_input": {"subagent_type": "custodiet", "prompt": "check compliance"},
      "is_subagent": false,
      "subagent_type": "custodiet",
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 55}
      },
      "expected": {"verdict": "allow"}
    },
    {
      "id": "edit_allowed_when_custodiet_below_threshold",
      "description": "Edit allowed when ops_since_open < threshold",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/some/file.py", "old_string": "a", "new_string": "b"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 10}
      },
      "expected": {"verdict": "allow"}
    }
  ],

  "hydration_trigger_opens_gate": [
    {
      "id": "subagent_start_hydrator_opens_gate",
      "description": "SubagentStart with prompt-hydrator type opens hydration gate",
      "hook_event": "SubagentStart",
      "tool_name": null,
      "tool_input": {},
      "is_subagent": false,
      "subagent_type": "aops-core:prompt-hydrator",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "gate_after": {"hydration": "open"}}
    },
    {
      "id": "subagent_stop_hydrator_opens_gate",
      "description": "SubagentStop with prompt-hydrator type opens hydration gate",
      "hook_event": "SubagentStop",
      "tool_name": null,
      "tool_input": {},
      "is_subagent": false,
      "subagent_type": "prompt-hydrator",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "gate_after": {"hydration": "open"}}
    },
    {
      "id": "pretooluse_task_hydrator_opens_gate",
      "description": "PreToolUse with Task calling hydrator opens hydration gate via trigger",
      "hook_event": "PreToolUse",
      "tool_name": "Task",
      "tool_input": {"subagent_type": "aops-core:prompt-hydrator", "prompt": "hydrate"},
      "is_subagent": false,
      "subagent_type": "aops-core:prompt-hydrator",
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/hydration.md"}}
      },
      "expected": {"verdict": "allow", "gate_after": {"hydration": "open"}}
    }
  ],

  "custodiet_trigger_resets_counter": [
    {
      "id": "subagent_start_custodiet_resets_ops",
      "description": "SubagentStart with custodiet type resets ops counter",
      "hook_event": "SubagentStart",
      "tool_name": null,
      "tool_input": {},
      "is_subagent": false,
      "subagent_type": "aops-core:custodiet",
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 55}
      },
      "expected": {"verdict": "allow", "ops_reset": true}
    },
    {
      "id": "subagent_stop_custodiet_resets_ops",
      "description": "SubagentStop with custodiet type resets ops counter",
      "hook_event": "SubagentStop",
      "tool_name": null,
      "tool_input": {},
      "is_subagent": false,
      "subagent_type": "custodiet",
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 48}
      },
      "expected": {"verdict": "allow", "ops_reset": true}
    }
  ],

  "stop_gate_behavior": [
    {
      "id": "stop_warned_when_handover_closed",
      "description": "Stop event is warned when handover gate is closed (mode=warn)",
      "hook_event": "Stop",
      "tool_name": null,
      "tool_input": {},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "handover": {"status": "closed"},
        "qa": {"status": "open"}
      },
      "expected": {"verdict": "warn"}
    },
    {
      "id": "stop_denied_when_qa_closed",
      "description": "Stop event is denied when QA gate is closed (mode=block). Requires temp_path for template.",
      "hook_event": "Stop",
      "tool_name": null,
      "tool_input": {},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "handover": {"status": "open"},
        "qa": {"status": "closed", "metrics": {"temp_path": "/tmp/qa-review.md"}}
      },
      "expected": {"verdict": "deny"}
    },
    {
      "id": "stop_allowed_when_all_gates_open",
      "description": "Stop event allowed when all gates are open",
      "hook_event": "Stop",
      "tool_name": null,
      "tool_input": {},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "handover": {"status": "open"},
        "qa": {"status": "open"}
      },
      "expected": {"verdict": "allow"}
    }
  ],

  "claude_output_format": [
    {
      "id": "claude_pretooluse_deny_format",
      "description": "Claude Code PreToolUse deny uses hookSpecificOutput.permissionDecision=deny",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/f.py", "old_string": "a", "new_string": "b"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 55}
      },
      "client": "claude",
      "expected": {
        "verdict": "deny",
        "claude_permission_decision": "deny"
      }
    },
    {
      "id": "claude_pretooluse_warn_format",
      "description": "Claude Code PreToolUse warn maps to hookSpecificOutput.permissionDecision=allow (warn allows tool but adds context)",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/f.py", "old_string": "a", "new_string": "b"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/h.md"}}
      },
      "client": "claude",
      "expected": {
        "verdict": "warn",
        "claude_permission_decision": "allow"
      }
    },
    {
      "id": "claude_stop_deny_format",
      "description": "Claude Code Stop deny uses decision=block (not hookSpecificOutput)",
      "hook_event": "Stop",
      "tool_name": null,
      "tool_input": {},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "handover": {"status": "open"},
        "qa": {"status": "closed", "metrics": {"temp_path": "/tmp/qa-review.md"}}
      },
      "client": "claude",
      "expected": {
        "verdict": "deny",
        "claude_stop_decision": "block"
      }
    }
  ],

  "gemini_output_format": [
    {
      "id": "gemini_pretooluse_deny_format",
      "description": "Gemini CLI deny uses decision=deny",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/f.py", "old_string": "a", "new_string": "b"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"},
        "custodiet": {"status": "open", "ops_since_open": 55}
      },
      "client": "gemini",
      "expected": {
        "verdict": "deny",
        "gemini_decision": "deny"
      }
    },
    {
      "id": "gemini_pretooluse_allow_format",
      "description": "Gemini CLI allow uses decision=allow",
      "hook_event": "PreToolUse",
      "tool_name": "Read",
      "tool_input": {"path": "/some/file.py"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "open"}
      },
      "client": "gemini",
      "expected": {
        "verdict": "allow",
        "gemini_decision": "allow"
      }
    }
  ],

  "combined_gate_interactions": [
    {
      "id": "both_hydration_and_custodiet_fire",
      "description": "When both hydration (warn) and custodiet (deny) fire, deny wins",
      "hook_event": "PreToolUse",
      "tool_name": "Edit",
      "tool_input": {"file_path": "/f.py", "old_string": "a", "new_string": "b"},
      "is_subagent": false,
      "subagent_type": null,
      "gate_overrides": {
        "hydration": {"status": "closed", "metrics": {"temp_path": "/tmp/h.md"}},
        "custodiet": {"status": "open", "ops_since_open": 55}
      },
      "expected": {"verdict_in": ["warn", "deny"], "not_allow": true}
    }
  ]
}
